---
title: "Improving the Global Terrorism Index Visualization"
author: "Coral Team"
format: html
editor: visual
---

## Introduction

The original chart visualizing the Global Terrorism Index lacked clarity in terms of trends and country comparisons across time. Our objective is to improve interpretability while preserving the integrity of the data.

## Original Visualization

![Original GTI Chart](data/Original%20Chart.jpeg)

## Comparison Table: Strengths vs. Areas for Improvement

| ✅ What Works Well | ❌ What Could Be Improved |
|-------------------|----------------------------|
| **Title and Subtitle:** "The World's Terrorism Hotspots" clearly communicates purpose; subtitle explains GTI basis | **Geographic Context:** No map or regional grouping to show concentration in Africa/Middle East |
| **Chart Type:** Bar chart effectively compares values across countries | **Color Accessibility:** Dark maroon with white text may reduce legibility for some viewers |
| **Color Usage:** Consistent deep red reinforces severity theme appropriate to topic | **Interactivity:** Static image prevents exploration of additional data dimensions |
| **Country Identification:** Flags help users quickly identify nations without reading all names | **Visual Neutrality:** Background imagery (dove in crosshair) potentially adds emotional bias |
| **Score Display:** Numeric scores clearly labeled on each bar for precise comparison | **Temporal Context:** No visualization of trends over time despite 5-year data availability |
| **Source Citation:** Properly cites "Institute for Economics and Peace" with methodology explanation | **Score Interpretation:** Lacks scale context to help viewers understand meaning of scores |

## Data Preparation

We used the *Global Terrorism Index 2023.xlsx* file from the Institute for Economics and Peace. The `Overall Scores` sheet was selected due to its completeness and structured format.

```{r}

library(readxl)
library(dplyr)
library(tidyr)
library(ggplot2)

# Load the data
df <- read_excel("data/Global Terrorism Index 2023.xlsx", sheet = "Overall Scores")

# Convert to long format
long_df <- df %>%
  pivot_longer(cols = matches("^[0-9]{4} Score$"), names_to = "Year", values_to = "Score") %>%
  mutate(Year = as.integer(gsub(" Score", "", Year)))

# Filter top 15 countries based on latest score
top15 <- df %>%
  select(Country, `2022 Score`) %>%
  arrange(desc(`2022 Score`)) %>%
  slice(1:15) %>%
  pull(Country)

filtered_df <- long_df %>%
  filter(Country %in% top15)

# Plot the data
ggplot(filtered_df, aes(x = Year, y = Score, color = Country)) +
  geom_line(linewidth = 1.2) +   # ← updated here
  geom_point() +
  theme_minimal() +
  labs(title = "Top 15 Countries by Terrorism Index Score (2012–2022)",
       y = "GTI Score",
       x = "Year",
       color = "Country") +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"),
        legend.position = "bottom",
        legend.title = element_text(face = "bold"))

```

```{r}
# ─── Top-15 GTI Map with Discrete Country Legend ───

#  Install any missing packages (once):
# install.packages(c(
#   "readxl","dplyr","tidyr","sf","rnaturalearth","ggplot2",
#   "viridis","ggspatial","ggrepel","countrycode"
# ))

library(readxl)
library(dplyr)
library(tidyr)
library(sf)
library(rnaturalearth)
library(ggplot2)
library(viridis)
library(ggspatial)
library(ggrepel)
library(countrycode)
library(grid)   # for unit()

# 1. Load & reshape the GTI data
df <- read_excel("data/Global Terrorism Index 2023.xlsx",
                 sheet = "Overall Scores")

long_df <- df %>%
  pivot_longer(
    cols      = matches("^[0-9]{4} Score$"),
    names_to  = "Year",
    values_to = "Score"
  ) %>%
  mutate(Year = as.integer(sub(" Score", "", Year)))

# 2. Identify Top-15 countries by GTI in 2021
top15_2021 <- long_df %>%
  filter(Year == 2021) %>%
  slice_max(Score, n = 15) %>%
  pull(Country)

# 3. Load world map & join scores for those Top-15, add continent
world <- ne_countries(scale = "medium", returnclass = "sf")

world_top15 <- world %>%
  filter(name %in% top15_2021) %>%
  left_join(
    long_df %>% filter(Year == 2021) %>% select(Country, Score),
    by = c("name" = "Country")
  ) %>%
  mutate(
    continent = countrycode(name,
                            origin      = "country.name",
                            destination = "continent")
  )

# 4. Compute a tight bounding box + small buffer for zoom
bb    <- st_bbox(world_top15)
xbuf  <- (bb$xmax - bb$xmin) * 0.05
ybuf  <- (bb$ymax - bb$ymin) * 0.05
xlims <- c(bb$xmin - xbuf, bb$xmax + xbuf)
ylims <- c(bb$ymin - ybuf, bb$ymax + ybuf)

# 5. Build continent envelopes (convex hulls)
hulls <- world_top15 %>%
  group_by(continent) %>%
  summarise(geometry = st_union(geometry), .groups = "drop") %>%
  st_convex_hull()

# 6. Label locations for those envelopes
hull_centroids <- st_centroid(hulls)
hull_labels <- hull_centroids %>%
  st_coordinates() %>%
  as_tibble() %>%
  bind_cols(select(hulls, continent))

# 7. Prepare discrete legend labels and palette
world_top15 <- world_top15 %>%
  arrange(continent, desc(Score)) %>%
  mutate(
    lbl = paste0(name, " (", round(Score,1), ")"),
    lbl = factor(lbl, levels = unique(lbl))
  )

palette <- viridis::viridis(n = nrow(world_top15), option = "plasma")
names(palette) <- levels(world_top15$lbl)

# 8. Draw the map with discrete country legend
ggplot() +
  # a) all world in light grey
  geom_sf(data = world,
          fill  = "grey90",
          color = "white",
          size  = 0.1) +
  
  # b) highlight Top-15, fill by discrete label
  geom_sf(data = world_top15,
          aes(fill = lbl),
          color = "white",
          size  = 0.2) +
  
  # c) dashed continent envelopes
  geom_sf(data = hulls,
          fill      = NA,
          color     = "black",
          linetype  = "dashed",
          size      = 0.5) +
  
  # d) continent labels
  geom_text(data = hull_labels,
            aes(X, Y, label = continent),
            fontface = "bold",
            size     = 4,
            color    = "black") +
  
  # e) manual palette for discrete country labels
  scale_fill_manual(
    values = palette,
    name   = "Country & Score",
    guide  = guide_legend(
      ncol        = 1,
      byrow       = FALSE,
      label.theme = element_text(size = 7)
    )
  ) +
  
  # f) zoom to hotspot region
  coord_sf(xlim   = xlims,
           ylim   = ylims,
           expand = FALSE) +
  
  # g) scale bar
  annotation_scale(location   = "bl",
                   width_hint = 0.3) +
  
  # h) titles & caption
  labs(
    title    = "Terrorism Hotspots: Top-15 GTI Countries (2021)",
    subtitle = "Grouped by continent (dashed), zoomed to the cluster",
    caption  = "Source: Institute for Economics & Peace"
  ) +
  
  # i) clean, map-only theme
  theme_void(base_size = 14) +
  theme(
    plot.title      = element_text(face = "bold", hjust = 0.5),
    plot.subtitle   = element_text(hjust = 0.5),
    plot.caption    = element_text(size = 8),
    legend.position = "right"
  )


```

## GTI Score vs. Fatalities (2022) \[Another Example\]

To assess how well the GTI score reflects actual impact, we visualized the relationship between the 2022 score and the number of fatalities from terrorist incidents.

```{r}
library(readxl)
library(dplyr)
library(ggplot2)

# Load 2022 data
data_2022 <- read_excel("data/Global Terrorism Index 2023.xlsx", sheet = "2022")

# Clean column names if necessary
colnames(data_2022) <- make.names(colnames(data_2022))

# Filter out missing values
data_clean <- data_2022 %>%
  filter(!is.na(Score) & !is.na(Fatalities))

# Create scatter plot
ggplot(data_clean, aes(x = Score, y = Fatalities, label = Country)) +
  geom_point(color = "tomato", size = 3, alpha = 0.7) +
  geom_text(size = 3, hjust = 1.1, check_overlap = TRUE) +
  theme_minimal() +
  labs(title = "GTI Score vs. Fatalities in 2022",
       x = "GTI Score",
       y = "Number of Fatalities",
       caption = "Data source: Institute for Economics and Peace") +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"))

```

Insight:

-   There is a general positive relationship between GTI Score and fatalities.

-   Some countries have high scores but relatively fewer fatalities, suggesting score includes other risk factors (e.g., fear, threat perception, policy).
